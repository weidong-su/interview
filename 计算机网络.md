图解网络：https://xiaolincoding.com/network/1_base/what_happen_url.html#%E5%8F%AF%E9%9D%A0%E4%BC%A0%E8%BE%93-tcp


# 在浏览器地址栏输入一个URL后回车，背后会进行哪些技术步骤？


当你在浏览器地址栏输入一个URL并按下回车后，浏览器会进行以下的技术步骤：

1. URL解析：浏览器首先会对你输入的URL进行解析。这涉及到检查URL的格式是否正确，以及是否包含必要的部分，如协议（如http://或https://）、域名和路径等。
2. DNS解析：浏览器需要将输入的域名（如www.baidu.com）转换为对应的IP地址。这是通过DNS（域名系统）服务器完成的。浏览器会向DNS服务器发送查询请求，获取服务器的IP地址。如果浏览器缓存中有这个域名的解析结果，那么就会直接使用缓存中的结果，否则会向DNS服务器请求解析。
3. 建立TCP连接：一旦浏览器获得了服务器的IP地址，它就会开始与服务器建立TCP（传输控制协议）连接。TCP是一种面向连接的协议，它能保证数据的可靠传输。
4. 发送HTTP请求：建立TCP连接后，浏览器会发送HTTP（超文本传输协议）请求到服务器。HTTP请求中包含了请求的资源路径、请求方法（如GET、POST等）以及请求头等信息。
5. 接收服务器响应：服务器收到浏览器的HTTP请求后，会处理请求并生成相应的HTTP响应。HTTP响应中包含了服务器返回的资源内容，如HTML文件、CSS样式、JavaScript脚本、图片等。
6. 页面渲染：浏览器接收到服务器的HTTP响应后，会开始解析和渲染页面。这涉及到解析HTML、CSS和JavaScript等，以及下载和显示图片等资源。
7. 关闭TCP连接：在数据传输完成后，浏览器会关闭与服务器的TCP连接。这是通过TCP的四次挥手过程实现的。

# TCP是如何保证可靠传输的？

> https://zhuanlan.zhihu.com/p/37379780

TCP（传输控制协议）通过多种方式保证可靠传输，主要包括以下几个方面：

1. 校验和：TCP在发送数据时，会对每个数据包进行校验和的计算。接收方在收到数据包后，也会进行同样的校验和计算。如果计算结果与发送方的校验和不匹配，接收方就会丢弃这个数据包，并通知发送方重新发送。这样可以确保数据的完整性和正确性。
2. 序列号：TCP给发送的每一个数据包（报文段）进行编号，这就是序列号。接收方会根据序列号对数据包进行排序，这样可以确保数据的顺序性。同时，序列号还可以帮助识别重复的数据包，并丢弃它们，防止数据重复。
3. 确认应答：接收方在收到数据包后，会向发送方发送确认应答（ACK），告诉发送方已经成功接收到哪些数据包。如果发送方在一定时间内没有收到确认应答，就会重新发送数据包，这就是超时重传机制。这样可以确保数据的可靠传输。
4. 流量控制：TCP使用滑动窗口协议进行流量控制，防止发送方发送的数据过多，导致接收方来不及处理。接收方会告诉发送方自己的接收窗口大小，即可以接收的最大数据量。发送方会根据接收窗口的大小来发送数据，避免数据丢失。
5. 拥塞控制：当网络拥塞时，TCP会减少数据的发送速率，避免网络拥塞进一步恶化。TCP通过监测网络拥塞的程度，动态调整发送速率，保证数据的可靠传输。

总的来说，TCP通过以上几种方式，保证了数据的可靠传输，即数据的完整性、顺序性、可靠性和流量控制。

# TCP和UDP的区别

> https://jaminzhang.github.io/network/The-Difference-Between-TCP-And-UDP-Protocol/

TCP和UDP都是传输层的协议，但它们在多个方面存在显著的区别。
1. 连接

TCP 是面向连接的传输层协议，传输数据前先要建立连接。
UDP 是不需要连接，即刻传输数据。
2. 服务对象

TCP 是一对一的两点服务，即一条连接只有两个端点。
UDP 支持一对一、一对多、多对多的交互通信
3. 可靠性

TCP 是可靠交付数据的，数据可以无差错、不丢失、不重复、按序到达。
UDP 是尽最大努力交付，不保证可靠交付数据。但是我们可以基于 UDP 传输协议实现一个可靠的传输协议，比如 QUIC 协议，具体可以参见这篇文章：如何基于 UDP 协议实现可靠传输？(opens new window)
4. 拥塞控制、流量控制

TCP 有拥塞控制和流量控制机制，保证数据传输的安全性。
UDP 则没有，即使网络非常拥堵了，也不会影响 UDP 的发送速率。
5. 首部开销

TCP 首部长度较长，会有一定的开销，首部在没有使用「选项」字段时是 20 个字节，如果使用了「选项」字段则会变长的。
UDP 首部只有 8 个字节，并且是固定不变的，开销较小。
6. 传输方式

TCP 是流式传输，没有边界，但保证顺序和可靠。
UDP 是一个包一个包的发送，是有边界的，但可能会丢包和乱序。
7. 分片不同

TCP 的数据大小如果大于 MSS 大小，则会在传输层进行分片，目标主机收到后，也同样在传输层组装 TCP 数据包，如果中途丢失了一个分片，只需要传输丢失的这个分片。
UDP 的数据大小如果大于 MTU 大小，则会在 IP 层进行分片，目标主机收到后，在 IP 层组装完数据，接着再传给传输层。
TCP 和 UDP 应用场景：

由于 TCP 是面向连接，能保证数据的可靠性交付，因此经常用于：

FTP 文件传输；
HTTP / HTTPS；
由于 UDP 面向无连接，它可以随时发送数据，再加上 UDP 本身的处理既简单又高效，因此经常用于：

包总量较少的通信，如 DNS 、SNMP 等；
视频、音频等多媒体通信；
广播通信；

# HTTPS和HTTP的区别
HTTPS和HTTP的主要区别体现在以下几个方面：

1. 安全性：HTTP是一个简单的请求-响应协议，特点是无状态和明文传输。这意味着使用HTTP协议传输的数据都是未加密的，因此传输隐私信息非常不安全。相反，HTTPS是HTTP加上SSL协议组合形成的一种加密传输协议，对网站与客户端之间传输的数据进行加密，因此不存在数据泄露的问题，具有更高的安全性。
2. 响应速度：理论上，HTTP的响应速度更快，因为它只需三次握手即可建立连接。而HTTPS除了三次握手外，还需进行SSL握手，因此总共需要12个包，这可能导致其响应速度稍慢于HTTP。
3. 端口：HTTP和HTTPS使用完全不同的连接方式，并采用不同的端口。HTTP使用的是80端口，而HTTPS则使用443端口。
4. 资源消耗：由于HTTPS是构建在SSL之上的HTTP协议，因此它会消耗更多的服务器资源。
5. 费用：HTTPS协议需要到CA申请证书，一般免费证书较少，因此可能需要一定的费用。而HTTP则无需此类费用。

# http1.0 / 1.1 / 2 / 3的区别
> https://www.jianshu.com/p/cd70b8e90d00

HTTP1.0、HTTP1.1、HTTP2和HTTP3这几个版本的主要区别体现在连接管理、资源请求、头部处理、性能提升以及安全性等方面。

1. 连接管理：
HTTP1.0默认使用非持久连接，即每次请求都需要建立一个新的TCP连接，并在请求完成后关闭连接。这种连接方式在处理大量请求时可能会产生较大的开销。
HTTP1.1引入了持久连接（也称为长连接），通过Connection: keep-alive头部字段实现。这使得多个请求可以复用同一个TCP连接，减少了建立和关闭连接的开销。
HTTP2采用了二进制分帧层，使得多个请求可以并发地在一个单一的连接上执行，进一步提高了效率。

2. 资源请求：
HTTP1.0在处理资源请求时，如果客户端只需要对象的一部分，服务器仍然会发送整个对象，这可能导致带宽的浪费。
HTTP1.1引入了Range头部字段，支持分片资源传输，允许客户端只请求资源的某个部分。
HTTP2通过多路复用，支持多个请求并发，不存在队头阻塞的问题，可以更有效地利用带宽。

3. 头部处理：
HTTP1.1增加了多种缓存处理的请求头，提供了更丰富的缓存控制策略。
HTTP2引入了头部压缩机制，使用HPACK算法对头部信息进行压缩，减少了传输开销。

4. 性能提升：
HTTP1.1通过引入持久连接和请求流水线处理（Pipelining），减少了连接建立和请求处理的延迟。
HTTP2进一步通过二进制编码、多路复用等技术，显著提高了传输效率。
HTTP3基于QUIC协议，进一步减少了连接延迟，提高了网络传输的效率。

5. 安全性：
HTTP1.0和HTTP1.1都是明文传输，存在安全风险。虽然HTTP1.1提供了更多的缓存和安全性控制，但仍然不支持服务器推送消息。
HTTP2虽然提高了性能，但在安全性方面并没有直接改进。
HTTP3基于UDP的QUIC协议，提供了更好的安全性和可靠性保证。

总的来说，从HTTP1.0到HTTP3，每个版本都在不断地优化和改进，以更好地适应网络环境和应用需求的变化。随着技术的不断发展，未来的HTTP版本可能会继续引入更多的新特性和优化措施。


# 粘包和拆包你听说过吗？它是基于TCP还是UDP的？
> https://zhuanlan.zhihu.com/p/356225028

粘包和拆包是网络通信中常见的问题，特别是在使用TCP协议时。这是因为TCP是面向流的传输协议，它将上层应用的数据流视为字节流，没有明确的报文边界，所以在发送和接收数据时可能会出现粘包和拆包的现象。

粘包是指发送方发送的两个或多个数据包在接收方粘在一起，被接收方当作一个数据包处理。而拆包则是发送方发送的一个数据包在接收方被拆分成多个数据包处理。

相对地，UDP是面向消息的传输协议，它保留了应用层发送数据的报文边界，每个UDP报文都对应着一次send或recv调用。因此，UDP不会出现粘包和拆包的问题。

要解决TCP的粘包和拆包问题，可以采取以下几种方法：

1. 消息定长：每个消息或报文的大小固定，例如每个报文长度都是200字节。如果不够，则通过补0或其他方式来填充。接收方每次读取固定长度的数据作为一条完整的消息。
2. 添加特殊字符作为消息边界：在消息之间加入特定的分隔符，例如回车换行符（\r\n）。接收方在读取数据时，通过检测这个分隔符来确定消息的边界。
3. 消息头+消息体：在每条消息前加入一个消息头，消息头中包含表示消息长度的字段。接收方在读取数据时，首先读取消息头，根据消息头的长度字段来确定后续消息体的长度，从而避免粘包和拆包的问题。

此外，虽然这种方法效率较低，但也可以考虑使用延时发送的方式来解决粘包问题，即发送方在发送完一个数据包后，等待一段时间再发送下一个数据包，以确保接收方能够区分不同的数据包。但这种方法可能会增加网络通信的延迟，影响实时性。

总的来说，解决TCP粘包和拆包问题需要根据具体的应用场景和需求来选择合适的方法。

# 你可以讲一下三握四挥的具体过程吗？包括三次握手和四次挥手

![TCP三次握手](https://github.com/weidong-su/interview/assets/42209591/d12c1853-fba7-46cb-97fe-9be80f07d341)

三次握手（建立连接）

一开始，客户端和服务端都处于 `CLOSED` 状态。先是服务端调用`listen` 系统调用主动监听某个端口，处于`LISTEN` 状态。
SYN（同步）阶段：
客户端调用connect系统调用，主动请求服务器，向服务器发送一个SYN包，请求建立连接。这个包中包含了客户端的初始序列号(Initial Sequence Number, ISN) x。
客户端进入SYN_SEND状态，等待服务器的确认。
SYN+ACK（同步+确认）阶段：
服务器收到SYN包后（listen系统调用返回非空），确认客户端的SYN（ACK x+1），同时自己也发送一个SYN包，即SYN+ACK包，这个包中包含了服务器的初始序列号(ISN)y。
服务器进入SYN_RECV状态。
ACK（确认）阶段：
客户端收到服务器的SYN+ACK包后，向服务器发送确认包ACK y+1，表示收到了服务器的SYN。
客户端和服务器进入ESTABLISHED状态，完成TCP三次握手。

四次挥手（终止连接）

FIN（结束）阶段：

1. 客户端主动调用关闭连接的函数（（通过close/shutdown系统调用）），于是就会发送 FIN 报文，这个  FIN 报文代表客户端不会再发送数据了，进入 FIN_WAIT_1 状态；
2. 服务端收到了 FIN 报文，然后马上回复一个 ACK 确认报文，此时服务端进入 CLOSE_WAIT 状态。在收到 FIN 报文的时候，TCP 协议栈会为 FIN 包插入一个文件结束符 EOF 到接收缓冲区中，服务端应用程序可以通过 read 调用来感知这个 FIN 包，这个 EOF 会被放在已排队等候的其他已接收的数据之后，所以必须要得继续 read 接收缓冲区已接收的数据；
3. 接着，当服务端在 read 数据的时候，最后自然就会读到 EOF，接着read() 就会返回 0，这时服务端应用程序如果有数据要发送的话，就发完数据后才调用关闭连接的函数，如果服务端应用程序没有数据要发送的话，可以直接调用关闭连接的函数，这时服务端就会发一个 FIN 包，这个  FIN 报文代表服务端不会再发送数据了，之后处于 LAST_ACK 状态；
4. 客户端接收到服务端的 FIN 包，并发送 ACK 确认包给服务端，此时客户端将进入 TIME_WAIT 状态；
5. 服务端收到 ACK 确认包后，就进入了最后的 CLOSE 状态；
6. 客户端经过 2MSL 时间之后，也进入 CLOSE 状态；
   
可以看到，每个方向都需要一个 FIN 和一个 ACK，因此通常被称为四次挥手。

# 四次挥手中的ack链接和之后的释放链可以合并吗？/四次挥手中确认报文和释放连接可以同时发送吗？
> https://www.51cto.com/article/717235.html

当被动关闭方（上图的服务端）在 TCP 挥手过程中，「没有数据要发送」并且「开启了 TCP 延迟确认机制」，那么第二和第三次挥手就会合并传输，这样就出现了三次挥手。

TCP 延迟确认的策略：
+ 当有响应数据要发送时，ACK 会随着响应数据一起立刻发送给对方
+ 当没有响应数据要发送时，ACK 将会延迟一段时间，以等待是否有响应数据可以一起发送
+ 如果在延迟等待发送 ACK 期间，对方的第二个数据报文又到达了，这时就会立刻发送 ACK

# 除了常见的拥塞控制、滑动窗口等机制外，TCP还有什么机制可以保证可以？比如报文上的一些检验等？

除了拥塞控制、滑动窗口等常见的机制外，TCP还有一些机制可以提高通信的可靠性和安全性，其中包括以下几个：

校验和检验：TCP在传输数据时会计算校验和，接收方在接收数据时会重新计算校验和，并将其与发送方提供的校验和进行比较，以确保数据在传输过程中没有被篡改或损坏。

序列号和确认号：TCP在每个数据包中都包含了序列号和确认号，用于确保数据的有序传输和可靠接收。序列号用于标识每个数据包的顺序，确认号用于反馈接收到的数据包序列号，以便发送方知道哪些数据包已经成功接收。

超时重传：TCP在发送数据时会设置超时时间，如果在超时时间内未收到确认，则会重新发送数据包，以确保数据的可靠传输。

流量控制：TCP通过窗口控制机制来实现流量控制，确保发送方和接收方之间的数据传输速率适应网络的状况，避免数据包丢失或拥塞。

连接管理：TCP通过三次握手和四次挥手来建立和终止连接，确保双方的通信状态正确转换，避免数据混乱或丢失。

总的来说，TCP通过以上这些机制可以保证数据的可靠传输和通信的稳定性，确保数据在网络中的安全传输和正确接收。

# 什么是 SYN 攻击？如何避免 SYN 攻击？

SYN 攻击是一种常见的网络攻击方式，它利用TCP协议中的三次握手过程中的漏洞，通过向目标服务器发送大量伪造的TCP连接请求（SYN包），导致服务器资源耗尽，无法正常处理真实的连接请求，从而使服务器无法提供正常的服务。

为了避免 SYN 攻击，可以采取以下几种措施：

1. 启用 SYN 攻击防护：许多网络设备和防火墙都提供了专门的 SYN 攻击防护功能，可以通过配置这些设备来检测和阻止 SYN 攻击。

2. 调整服务器的 TCP 连接参数：可以调整服务器的 TCP 连接参数，如减小 SYN-ACK 超时时间、增加 SYN/ACK 的重传次数等，以减少对服务器资源的消耗。

3. 使用 SYN Cookie 技术：SYN Cookie 是一种用来抵御 SYN 攻击的技术，它通过在 SYN-ACK 包中加入一些伪随机生成的信息，来避免服务器端保存半开连接状态。

4. 使用反向代理和负载均衡器：通过使用反向代理和负载均衡器来分担服务器的负载，可以有效减轻服务器受到 SYN 攻击的影响。

5. 监控网络流量：定期监控服务器的网络流量，及时发现异常流量并采取相应措施应对。

6. 限制未授权访问：对于非必要的服务和端口，应该进行严格的访问控制，只允许授权的用户或设备进行访问。这样可以减少攻击者利用漏洞进行SYN攻击的机会。

> 反向代理（Reverse Proxy）：
> 反向代理是一种网络服务器的部署方式，它代表客户端与多个后端服务器之间通信。客户端向反向代理发送请求，反向代理根据一定的规则将请求转发给其中一个后端服务器，然后将后端服> 务器的响应返回给客户端。反向代理隐藏了后端服务器的真实信息，提高了网络安全性，并且可以实现负载均衡、缓存、SSL终结等功能。

> 负载均衡器（Load Balancer）：
> 负载均衡器是一种用于分发网络流量的设备或软件，它可以将客户端请求均匀地分发给多个后端服务器，从而减轻单个服务器的负载，提高系统的性能和可靠性。负载均衡器可以根据不同的> 算法（如轮询、加权轮询、最少连接等）来决定将请求转发给哪个后端服务器，以实现负载均衡。负载均衡器还可以实现会话保持、健康检查、故障转移等功能


# TCP和UDP的使用场景
TCP和UDP是两种不同的传输层协议，它们各自适用于不同的使用场景。

TCP（传输控制协议）是一个面向连接的、可靠的、基于字节流的传输层通信协议。它提供了全双工通信，即在数据交换过程中，发送方和接收方都可以发送和接收数据。TCP在传输数据前需要先建立连接，确保数据的可靠传输。因此，TCP通常用于需要确保数据完整性和顺序性的场景，例如：

+ 文件传输：如FTP（文件传输协议）使用TCP来确保文件在传输过程中的完整性和准确性。
+ 网页浏览：HTTP（超文本传输协议）也使用TCP来传输网页数据，确保用户能够正确地浏览网页内容。
+ 电子邮件：SMTP（简单邮件传输协议）和POP3（邮局协议第3版）等电子邮件协议也使用TCP来确保邮件的可靠传输。

相比之下，UDP（用户数据报协议）是一个无连接的传输层协议。它不保证数据的可靠传输，也不维护连接状态。因此，UDP通常用于对实时性要求较高、对数据传输的可靠性要求相对较低的场景，例如：

+ 实时音视频传输：如在线视频、网络语音电话等应用，UDP能够提供较低的延迟，但可能会出现数据丢失或乱序的情况。
+ 网络游戏：在网络游戏中，UDP常用于实时更新游戏状态和数据，以保证游戏的流畅性和实时性。
+ DNS查询：DNS（域名系统）使用UDP进行域名解析，因为DNS查询通常只需要少量的数据，且对实时性要求较高。
+ 
综上所述，TCP和UDP各有其适用的场景。在选择使用哪种协议时，需要根据具体的应用需求和数据传输要求来进行权衡和选择。
